<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <link rel="stylesheet" href="./style/main.css">
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="https://code.highcharts.com/stock/highstock.js"></script>
    <script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
    <title>Stock Charter</title>
</head>
<body>
    <div id="container" style="width:100%; height:400px;"></div>
</body>
</html>
<script>
var seriesOptions = [],
  seriesCounter = 0,
  names = ['MSFT', 'AAPL', 'GOOG'];

function createChart() {

Highcharts.stockChart('container', {
  rangeSelector: {
    selected: 4
  },
  yAxis: {
    labels: {
      formatter: function() {
        return (this.value > 0 ? ' + ' : '') + this.value + '%';
      }
    },
    plotLines: [{
      value: 0,
      width: 2,
      color: 'silver'
    }]
  },
  plotOptions: {
    series: {
      compare: 'percent',
      showInNavigator: true,
      // turboThreshold: 0
    }
  },
  tooltip: {
    pointFormat: '<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b> ({point.change}%)<br/>',
    valueDecimals: 2,
    split: true
  },
  series: seriesOptions
});
}

$.each(names, function(i, name) {

$.post('/', {id: name.toLowerCase()}, function(data) {
  var newData = [];
  data = data.dataset_data
    console.log(data)
  data.data.forEach(function(point) {
    newData.push([new Date(point[0]).getTime(), point[1]]);
  });

  newData.reverse();

  seriesOptions[i] = {
    name: data.code,
    data: newData
  };

  // As we're loading the data asynchronously, we don't know what order it will arrive. So
  // we keep a counter and create the chart when all the data is loaded.
  seriesCounter += 1;

  if (seriesCounter === names.length) {
    createChart();
  }
});
});
</script>